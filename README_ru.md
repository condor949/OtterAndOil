# OtterAndOil

Проект моделирует движение автономных судов и наземных роботов в некотором поле с заданной интенсивностью (в качестве понятного примера, представьте что это нефтяной разлив). Код позволяет задавать параметры пространства, выбирать тип транспортного средства и контроллера, а затем запускать симуляцию с визуализацией результатов.

## Установка

```bash
pip install -r requirements.txt
```

## Запуск симуляции

```bash
python main.py -c config.json
```

*При рендеринге графиков используется LaTeX, поэтому для полного запуска может
потребоваться установленный TeX-дистрибутив.*

## Принцип работы

Скрипт `main.py` читает настройки из файла конфигурации и создаёт необходимые
объекты: транспортные средства, пространство и контроллер.
Для каждой серии расчётов класс `DataStorage` формирует каталог с меткой
времени внутри `data`, куда затем сохраняются все изображения.
При запуске с файлом `config.json` в каталоге `data/expt_gaussian_s1_<время>`
появятся:

- `gaussian_<время>.png` — карта интенсивности пространства;
- `sigmas_v0_<время>.png`, `cumulative_<время>.png`, `intensity_<время>.png`
  — графики параметров контроллера;
- `track_<время>.png` и `track_<время>.gif` — траектория движения
  агентов.

## Структура проекта

- **controllers** – алгоритмы управления:
  - `BaseController` — базовый интерфейс для расчёта управляющих воздействий и
    хранения настроек симуляции
  - `IntensityBasedController` — индивидуальный контроллер, использующий закон
    Матвеева и данные поля интенсивности для переключения пропеллеров
    ([doi:10.1109/TAC.2023.3284595](https://doi.org/10.1109/TAC.2023.3284595))
  - `SwarmController` — контроллер для управления роем роботов
- **vehicles** – модели транспортных средств:
  - `Vehicle` — базовый класс с общими параметрами, такими как начальная точка и
    методы динамики
  - `Dubins` — упрощённая модель колёсного робота с управлением угловыми
    скоростями колёс и геометрическими параметрами шасси
  - `Otter` — подробная модель катамарана Otter USV с параметрами корпуса и
    системой управления курсом, адаптированная из
    [PythonVehicleSimulator](https://github.com/cybergalactic/PythonVehicleSimulator/blob/master/src/python_vehicle_simulator/vehicles/otter.py)
- **spaces** – описание исследуемого пространства:
  - `BaseSpace` — инфраструктура для хранения пиков, смещения координат и
    построения поверхности интенсивности
  - `Gaussian3DSpace` — генерация гауссовых пиков заданной формы
  - `Parabolic3DSpace` — параболические пиковые формы с отсечением отрицательных
    значений
- **tools** – вспомогательные утилиты:
  - `dataStorage` — создание папок с отметкой времени и сохранение конфигурации
    и результатов
  - `random_generators` — генераторы случайных стартовых точек, цветов и другие
    утилиты
  - `common` — функции для автоматического вызова методов визуализации или
    сохранения результатов
- **lib** – библиотека с функциями динамики и одновременной симуляцией (`gnc.py`,
  `simultaneousLoop.py` и др.).
- **space-genereator.py** – графический инструмент на PyQt5 для интерактивного
  построения файлов пиков.

## Конфигурационные файлы

### `config.json`
Основной файл настроек. Поля:

| Поле | Описание |
|------|----------|
| `clean_cache` | удалить старые данные перед запуском |
| `big_picture` | строить крупные изображения (требует больше памяти) |
| `not_animated` | отключить анимацию трека |
| `store_raw` | сохранять сырые данные симуляции |
| `separating_plots` | создавать отдельные графики для агентов |
| `store_plot` | сохранять изображения вместо показа на экране |
| `isometric` | изометрический вид трека |
| `grid_size` | разрешение сетки пространства |
| `axis_abs_max` | половина длины осей пространства |
| `isolines` | число изолиний на поверхности |
| `peaks_filename` | файл с описанием пиков интенсивности |
| `cache_dir` | каталог для сохранения результатов |
| `peak_type` | тип пространства (`gaussian` или `parabolic`) |
| `controller_type` | используемый контроллер |
| `vehicle_types` | список типов транспортных средств |
| `start_points` | стартовые координаты агентов |
| `shift_vehicle` | смещение всех стартовых точек |
| `shift_xyz` | смещение всего пространства |
| `target_isoline` | уровень целевой изолинии |
| `sim_time_sec` | время моделирования в секундах |
| `sample_time` | шаг дискретизации |
| `cycles` | число повторов эксперимента |
| `radius` | радиус генерации случайных стартовых точек |
| `vehicles` | число агентов каждого типа |
| `FPS` | частота кадров при сохранении анимации |
| `V_current` | скорость текущей среды |
| `beta_current` | направление течения |

Все поля можно видеть в исходном файле `config.json`.
Тот же набор параметров реализован в классе
[`Arguments`](tools/dataStorage.py),
который используется для сериализации конфигурации.

### `peaks_.json`
Определяет набор пиков интенсивности для пространства. Каждый объект содержит
координаты центра (`x0`, `y0`), амплитуду и параметры ширины `sigma_x` и
`sigma_y`.

## Вспомогательные скрипты
- `space-genereator.py` — позволяет интерактивно создать файл пиков, описывающий
  форму поля. Результат сохраняется в формате `peaks_*.json`.

## Лицензия

Проект распространяется по лицензии MIT. Полный текст см. в файле `LICENSE`.

