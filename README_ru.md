# OtterAndOil

Проект моделирует движение автономных судов и наземных роботов в некотором поле с заданной интенсивностью (в качестве понятного примера, представьте что это нефтяной разлив). Код позволяет задавать параметры пространства, выбирать тип транспортного средства и контроллера, а затем запускать симуляцию с визуализацией результатов.

## Установка

```bash
pip install -r requirements.txt
```

## Запуск симуляции

```bash
python main.py -c config.json
```

*При рендеринге графиков используется LaTeX, поэтому для полного запуска может
потребоваться установленный TeX-дистрибутив.*

## Принцип работы

Скрипт `main.py` читает настройки из файла конфигурации и создаёт необходимые
объекты: транспортные средства, пространство и контроллер【F:main.py†L41-L117】.
Для каждой серии расчётов класс `DataStorage` формирует каталог с меткой
времени внутри `data`, куда затем сохраняются все изображения【F:tools/dataStorage.py†L33-L95】.
При запуске с файлом `config.json` в каталоге `data/expt_gaussian_s1_<время>`
появятся:

- `gaussian_<время>.png` — карта интенсивности пространства【F:spaces/BaseSpace.py†L107-L119】;
- `sigmas_v0_<время>.png`, `cumulative_<время>.png`, `intensity_<время>.png`
  — графики параметров контроллера【F:controllers/IntensityBasedController.py†L101-L176】;
- `track_<время>.png` и `track_<время>.gif` — траектория движения
  агентов【F:controllers/IntensityBasedController.py†L240-L264】.

## Структура проекта

- **controllers** – алгоритмы управления:
  - `BaseController` — базовый интерфейс для расчёта управляющих воздействий и
    хранения настроек симуляции【F:controllers/BaseController.py†L7-L24】
  - `IntensityBasedController` — индивидуальный контроллер, использующий закон
    Матвеева и данные поля интенсивности для переключения пропеллеров
    ([doi:10.1109/TAC.2023.3284595](https://doi.org/10.1109/TAC.2023.3284595))【F:controllers/IntensityBasedController.py†L31-L75】
  - `SwarmController` — контроллер для управления роем роботов【F:controllers/SwarmController.py†L5-L41】
- **vehicles** – модели транспортных средств:
  - `Vehicle` — базовый класс с общими параметрами, такими как начальная точка и
    методы динамики【F:vehicles/vehicle.py†L6-L36】
  - `Dubins` — упрощённая модель колёсного робота с управлением угловыми
    скоростями колёс и геометрическими параметрами шасси【F:vehicles/dubins.py†L12-L71】
  - `Otter` — подробная модель катамарана Otter USV с параметрами корпуса и
    системой управления курсом, адаптированная из
    [PythonVehicleSimulator](https://github.com/cybergalactic/PythonVehicleSimulator/blob/master/src/python_vehicle_simulator/vehicles/otter.py)【F:vehicles/otter.py†L50-L116】
- **spaces** – описание исследуемого пространства:
  - `BaseSpace` — инфраструктура для хранения пиков, смещения координат и
    построения поверхности интенсивности【F:spaces/BaseSpace.py†L9-L119】
  - `Gaussian3DSpace` — генерация гауссовых пиков заданной формы【F:spaces/GaussianSpace.py†L5-L30】
  - `Parabolic3DSpace` — параболические пиковые формы с отсечением отрицательных
    значений【F:spaces/ParabolicSpace.py†L5-L37】
- **tools** – вспомогательные утилиты:
  - `dataStorage` — создание папок с отметкой времени и сохранение конфигурации
    и результатов【F:tools/dataStorage.py†L7-L96】【F:tools/dataStorage.py†L98-L132】
  - `random_generators` — генераторы случайных стартовых точек, цветов и другие
    утилиты【F:tools/random_generators.py†L7-L71】【F:tools/random_generators.py†L74-L91】
  - `common` — функции для автоматического вызова методов визуализации или
    сохранения результатов【F:tools/common.py†L1-L17】
- **lib** – библиотека с функциями динамики и одновременной симуляцией (`gnc.py`,
  `simultaneousLoop.py` и др.).
- **space-genereator.py** – графический инструмент на PyQt5 для интерактивного
  построения файлов пиков.

## Конфигурационные файлы

### `config.json`
Основной файл настроек запуска. Поля:

| Поле | Описание |
|------|----------|
| `clean_cache` | удалить старые данные перед запуском |
| `big_picture` | строить крупные изображения (требует больше памяти) |
| `not_animated` | отключить анимацию трека |
| `store_raw` | сохранять сырые данные симуляции |
| `separating_plots` | создавать отдельные графики для агентов |
| `store_plot` | сохранять изображения вместо показа на экране |
| `isometric` | изометрический вид трека |
| `grid_size` | разрешение сетки пространства |
| `axis_abs_max` | половина длины осей пространства |
| `isolines` | число изолиний на поверхности |
| `peaks_filename` | файл с описанием пиков интенсивности |
| `cache_dir` | каталог для сохранения результатов |
| `peak_type` | тип пространства (`gaussian` или `parabolic`) |
| `controller_type` | используемый контроллер |
| `vehicle_types` | список типов транспортных средств |
| `start_points` | стартовые координаты агентов |
| `shift_vehicle` | смещение всех стартовых точек |
| `shift_xyz` | смещение всего пространства |
| `target_isoline` | уровень целевой изолинии |
| `sim_time_sec` | время моделирования в секундах |
| `sample_time` | шаг дискретизации |
| `cycles` | число повторов эксперимента |
| `radius` | радиус генерации случайных стартовых точек |
| `vehicles` | число агентов каждого типа |
| `FPS` | частота кадров при сохранении анимации |
| `V_current` | скорость текущей среды |
| `beta_current` | направление течения |

Все поля можно видеть в исходном файле `config.json`【F:config.json†L1-L28】.
Тот же набор параметров реализован в классе
[`Arguments`](tools/dataStorage.py)【F:tools/dataStorage.py†L98-L132】,
который используется для сериализации конфигурации.

### `peaks_.json`
Определяет набор пиков интенсивности для пространства. Каждый объект содержит
координаты центра (`x0`, `y0`), амплитуду и параметры ширины `sigma_x` и
`sigma_y`【F:peaks_.json†L1-L36】.

## Вспомогательные скрипты
- `space-genereator.py` — позволяет интерактивно создать файл пиков, описывающий
  форму поля. Результат сохраняется в формате `peaks_*.json`.

## Лицензия

Проект распространяется по лицензии MIT. Полный текст см. в файле `LICENSE`.

